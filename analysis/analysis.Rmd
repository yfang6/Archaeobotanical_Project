---
title: "Analysis for Project"
output: 
  html_document: 
    fig_height: 6
    fig_width: 9
    toc: yes
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.align = "center")
source("useful_functions.R")
load("output/analytical_data.RData")
library(ggplot2)
library(scales)
library(texreg)
```

# Univariate distributions
<a href="#top">Back to top</a>

I created barplots to display the distributions of periods and feature types, as well as boxplots of total seed density, millet density, luxury cereal density, and bean density. 

```{r period, echo=FALSE}
ggplot(huizui, aes(x=Period, y=..prop.., group=1))+
  geom_bar()+
  scale_y_continuous(labels = scales::percent)+
  labs(x="Periods", y=NULL,
       title = "Distribution of Periods")+
  theme_bw()
```

This barplot shows that there are three periods where the seeds are from--Yangshao, Longshan, and Erlitou. Most seed samples are from the Erlitou period (more than 80%). Yangshao and Longshan seeds constitute less than 10% of total seeds respectively, Yangshao seeds being the smallest proportion among those from the three periods. 

```{r feature_type, echo=FALSE}
ggplot(huizui, aes(x=FeatureType, y=..prop.., group=1))+
  geom_bar()+
  scale_y_continuous(labels = scales::percent)+
  labs(x="Feature Types", y=NULL,
       title = "Distribution of Feature Types")+
  theme_bw()
```

This barplot shows that among the three feature types, ash pits are the most common one, representing more than half of all seed samples. Approximately 40% of seed samples are found in houses, which is the second largest feature type. Slightly less than 15% of all seed samples are from ditches.

```{r total_seed_density, echo=FALSE}
ggplot(huizui, aes(y=TotalSeedDensity))+
  geom_boxplot(fill="grey", outlier.color = "red")+
  labs(y="Total Seed Density (#/L)",
       title="Boxplot of Total Seed Density")+
  theme_bw()
```

This boxplot shows that the total seed densities of all seed samples has a median of ~5.5 #/L, a 1st quartile of ~3 #/L, and a 3rd Quartile of ~13 #/L. The minimum is 0 which means there is/are sample(s) with no seed found. There are several outliers with extremly large numbers of seeds found per liter of the samples, the largest reaching 60 #/L.

```{r millet_density, echo=FALSE}
ggplot(huizui, aes(y=MilletDensity))+
  geom_boxplot(fill="grey", outlier.color = "red")+
  labs(y="Millet Density (#/L)",
       title="Boxplot of Millet Density")+
  theme_bw()
```

This boxplot shows that the millet seed densities of all seed samples have a median of ~1.5 #/L, a 1st quartile of ~0.5 #/L, and a 3rd Quartile of ~4.5 #/L. The minimum is 0 which means there is/are sample(s) with no millet found. There are several outliers, the maximum reaching 36 #/L.

```{r LC_density, echo=FALSE}
ggplot(huizui, aes(y=LCDensity))+
  geom_boxplot(fill="grey", outlier.color = "red")+
  labs(y="Luxury Cereal Density (#/L)",
       title="Boxplot of Luxury Cereal Density")+
  theme_bw()
```

This boxplot shows that the luxury cereal densities are obviously lower than millet densities. The luxury creal densities of all seed samples have a minimum, a 1st quartile and a median of 0 #/L, which means there are a considerable amount (at least 50%) of seed samples with no luxury cereal seed found. The LC densities have a 3rd quartile of ~0.1 #/L and there are several outliers. About 9 samples have LC densities from 0.25 to 1 #/L, and the maximum reaches 2.2 #/L.

```{r bean_density, echo=FALSE}
ggplot(huizui, aes(y=BeanDensity))+
  geom_boxplot(fill="grey", outlier.color = "red")+
  labs(y="Bean Density (#/L)",
       title="Boxplot of Bean Density")+
  theme_bw()
```

This boxplot shows that the bean densities seem to be between millet densities and the luxury cereal densities. The bean densities of all seed samples have a 1st quartile and a minimum of 0 #/L, which means at least 25% of all seed samples have no bean found. The bean densities have a 3rd quartile of ~0.45 #/L and there are several outliers. More than 10 samples have bean densities from 1 to 4 #/L, and the maximum almost reaches 5 #/L.

# Bivariate plots
<a href="#top">Back to top</a>

```{r totalDensity_period, echo=FALSE}
boxplot(huizui$TotalSeedDensity ~ huizui$Period, main = "Total Seed Density by Periods", xlab = "Periods", ylab = "Total Seed Density (#/L)", col = rainbow(3))
```

```{r milletDensity_period, echo=FALSE}
boxplot(huizui$MilletDensity ~ huizui$Period, main = "Millet Density by Periods", xlab = "Periods", ylab = "Millet Density (#/L)", col = rainbow(3))
```

```{r LC_period, echo=FALSE}
boxplot(huizui$LCDensity ~ huizui$Period, main = "Luxury Cereal Density by Periods", xlab = "Periods", ylab = "Luxury Cereal Density (#/L)", col = rainbow(3))
```

```{r beanDensity_period, echo=FALSE}
boxplot(huizui$BeanDensity ~ huizui$Period, main = "Bean Density by Periods", xlab = "Periods", ylab = "Bean Density (#/L)", col = rainbow(3))
```

```{r totalDensity_featureType, echo=FALSE}
boxplot(huizui$TotalSeedDensity ~ huizui$FeatureType, main = "Total Seed Density by Feature Types", xlab = "Feature Types", ylab = "Total Seed Density (#/L)", col = rainbow(3))
```

```{r milletDensity_featureType, echo=FALSE}
boxplot(huizui$MilletDensity ~ huizui$FeatureType, main = "Millet Density by Feature Types", xlab = "Feature Types", ylab = "Millet Density (#/L)", col = rainbow(3))
```

```{r LCDensity_featureType, echo=FALSE}
boxplot(huizui$LCDensity ~ huizui$FeatureType, main = "Luxury Cereal Density by Feature Types", xlab = "Feature Types", ylab = "Luxury Cereal Density (#/L)", col = rainbow(3))
```

```{r beanDensity_featureType, echo=FALSE}
boxplot(huizui$BeanDensity ~ huizui$FeatureType, main = "Bean Density by Feature Types", xlab = "Feature Types", ylab = "Bean Density (#/L)", col = rainbow(3))
```

# Poisson models
<a href="#top">Back to top</a>

```{r total_density_models, echo=FALSE, results="asis"}
total1 <- glm(TotalSeedNo~Period, family=poisson, offset=log(Vol), data=huizui)

total2 <- glm(TotalSeedNo~FeatureType, family=poisson, offset=log(Vol), data=huizui)

total3 <- glm(TotalSeedNo~Period+FeatureType, family=poisson, offset=log(Vol), data=huizui)

total4 <- glm(TotalSeedNo~Period*FeatureType, family=poisson, offset=log(Vol), data=huizui)

htmlreg(list(total1, total2, total3, total4),
          custom.coef.names = c("Intercept",
                             "Longshan Period",
                             "Yangshao Period",
                             "Ditch",
                             "House",
                             "Yangshao:Ditch",
                             "Longshan:House",
                             "Yangshao:House"),
          caption="Poisson models of total seed densities by period and feature types",
          caption.above = TRUE)
       
```

```{r millet_density_models, echo=FALSE, results="asis"}
millet1 <- glm(Millets~Period, family=poisson, offset=log(Vol), data=huizui)

millet2 <- glm(Millets~FeatureType, family=poisson, offset=log(Vol), data=huizui)

millet3 <- glm(Millets~Period+FeatureType, family=poisson, offset=log(Vol), data=huizui)

millet4 <- glm(Millets~Period*FeatureType, family=poisson, offset=log(Vol), data=huizui)

htmlreg(list(millet1, millet2, millet3, millet4),
          custom.coef.names = c("Intercept",
                             "Longshan Period",
                             "Yangshao Period",
                             "Ditch",
                             "House",
                             "Yangshao:Ditch",
                             "Longshan:House",
                             "Yangshao:House"),
          caption="Poisson models of millet densities by period and feature types",
          caption.above = TRUE)
       
```

```{r LC_density_models, echo=FALSE, results="asis"}
LC1 <- glm(LuxuryCereal~Period, family=poisson, offset=log(Vol), data=huizui)

LC2 <- glm(LuxuryCereal~FeatureType, family=poisson, offset=log(Vol), data=huizui)

LC3 <- glm(LuxuryCereal~Period+FeatureType, family=poisson, offset=log(Vol), data=huizui)

LC4 <- glm(LuxuryCereal~Period*FeatureType, family=poisson, offset=log(Vol), data=huizui)

htmlreg(list(LC1, LC2, LC3, LC4),
          custom.coef.names = c("Intercept",
                             "Longshan Period",
                             "Yangshao Period",
                             "Ditch",
                             "House",
                             "Yangshao:Ditch",
                             "Longshan:House",
                             "Yangshao:House"),
          caption="Poisson models of luxury cereal densities by period and feature types",
          caption.above = TRUE)
       
```

```{r bean_density_models, echo=FALSE, results="asis"}
bean1 <- glm(Bean~Period, family=poisson, offset=log(Vol), data=huizui)

bean2 <- glm(Bean~FeatureType, family=poisson, offset=log(Vol), data=huizui)

bean3 <- glm(Bean~Period+FeatureType, family=poisson, offset=log(Vol), data=huizui)

bean4 <- glm(Bean~Period*FeatureType, family=poisson, offset=log(Vol), data=huizui)

htmlreg(list(bean1, bean2, bean3, bean4),
          custom.coef.names = c("Intercept",
                             "Longshan Period",
                             "Yangshao Period",
                             "Ditch",
                             "House",
                             "Yangshao:Ditch",
                             "Longshan:House",
                             "Yangshao:House"),
          caption="Poisson models of bean densities by period and feature types",
          caption.above = TRUE)
       
```